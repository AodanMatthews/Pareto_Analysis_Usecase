unique_name: factinternetsales_ranked_by_product
object_type: dataset
label: factinternetsales_ranked_by_product
columns:
  - name: sales_reasons
    data_type: string
  - name: productkey
    data_type: int
  - name: product_info
    map:
      field_terminator: ','
      key_terminator: ':'
      key_type: String
      value_type: String
  - name: color
    data_type: string
    parent_column: product_info
  - name: size
    data_type: string
    parent_column: product_info
  - name: style
    data_type: string
    parent_column: product_info
  - name: weight
    data_type: string
    parent_column: product_info
  - name: orderquantity
    data_type: long
  - name: unitprice
    data_type: double
  - name: salesamount
    data_type: double
  - name: taxamt
    data_type: double
  - name: currencykey
    data_type: int
  - name: salesrank
    data_type: int
  - name: cumulativesales
    data_type: double
connection_id: con_atscale_inc_atscale_tutorials_as_adventure
sql: >
  SELECT
      DENSE_RANK() OVER ( ORDER BY sum(salesamount) DESC) AS salesrank,
      dimproduct.productkey as productkey,
      product_info,
      sum(orderquantity) as orderquantity,  
      avg(unitprice) as unitprice,
      sum(salesamount) as salesamount,
      sum(taxamt) as taxamt,
      currencykey,
      sum( sum(salesamount) ) OVER (
          ORDER BY sum(salesamount) DESC 
          ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW
      ) AS cumulativesales
  FROM as_adventure.factinternetsales 


  INNER JOIN as_adventure.dimproduct  ON factinternetsales.productkey =
  dimproduct.productkey


  WHERE orderdate >= '"2006-01-01 00:00:00"'
    AND orderdate < '"2006-03-31 00:00:00"'


  GROUP BY  
  
  dimproduct.productkey, 
  product_info, 
  currencykey


  ORDER BY  salesrank ASC
